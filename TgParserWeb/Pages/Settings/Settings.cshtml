@page
@model SettingsPageModel

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Настройки Telegram</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Настройки Telegram API</h1>

        <form method="post" class="mt-4">
            <div class="mb-3">
                <label for="sessionName" class="form-label">Имя сессии</label>
                <input type="text" id="sessionName" name="sessionName" class="form-control" value="@Model.SessionName" required>
            </div>

            <div class="mb-3">
                <label for="channels" class="form-label">Список каналов</label>
                <div id="channels" class="form-control">
                    @foreach (var channel in Model.Channels)
                    {
                        <div class="channel-entry d-flex mb-2">
                            <input type="text" name="channels[]" class="form-control me-2" value="@channel" required>
                            <button type="button" class="btn btn-danger remove-channel">Удалить</button>
                        </div>
                    }
                </div>
                <button type="button" class="btn btn-primary" id="addChannel">Добавить канал</button>
            </div>

            <div class="mb-3">
                <label for="messageLimit" class="form-label">Лимит сообщений</label>
                <input type="number" id="messageLimit" name="messageLimit" class="form-control" value="@Model.MessageLimit" required>
            </div>

            <div class="mb-3">
                <label for="startDate" class="form-label">Дата начала парсинга</label>
                <input type="date" id="startDate" name="startDate" class="form-control" value="@Model.ParseStartDate.ToString("yyyy-MM-dd")" required>
            </div>

            <div class="mb-3">
                <label for="duplicateThreshold" class="form-label">Коэффициент дубликатов</label>
                <input type="number" id="duplicateThreshold" name="duplicateThreshold" class="form-control" value="@Model.DuplicateThreshold" step="0.01" min="0" max="1" required>
            </div>

            <div class="mb-3">
                <label for="adThreshold" class="form-label">Коэффициент рекламы</label>
                <input type="number" id="adThreshold" name="adThreshold" class="form-control" value="@Model.AdThreshold" step="0.01" min="0" max="1" required>
            </div>

            <button type="submit" class="btn btn-primary">Сохранить</button>
            <a href="/" class="btn btn-secondary">Отмена</a>
        </form>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Добавление нового поля для канала
        document.getElementById('addChannel').addEventListener('click', function () {
            const channelEntry = document.createElement('div');
            channelEntry.classList.add('channel-entry', 'd-flex', 'mb-2');
            channelEntry.innerHTML = `
                    <input type="text" name="channels[]" class="form-control me-2" placeholder="Введите название канала" required>
                    <button type="button" class="btn btn-danger remove-channel">Удалить</button>
                `;
            document.getElementById('channels').appendChild(channelEntry);

            channelEntry.querySelector('.remove-channel').addEventListener('click', function () {
                channelEntry.remove();
            });
        });

        document.querySelectorAll('.remove-channel').forEach(button => {
            button.addEventListener('click', function () {
                this.closest('.channel-entry').remove();
            });
        });
    </script>
</body>
</html>
